{"version":3,"sources":["main.js"],"names":["$","canvas","fabric","Canvas","preserveObjectStacking","document","onkeydown","event","e","window","arguments","callee","caller","keyCode","obj","getActiveObject","remove","sendBackwards","bringForward","textInit","getObjects","each","index","item","type","on","attr","val","text","update_text","t","length","set","discardActiveObject","renderAll","downloadImg","download","toDataURL","outputInfo","console","log","top","left","angle","scaleX","scaleY","addToGif","dataUrl","li","append","downloadGif","theDelay","alert","gif","GIF","workerScript","workers","quality","width","height","addFrame","delay","blob","render","Text","insertAt","cornerSize","padding","transparentCorners","cornerStyle","cornerColor","borderColor","borderSize","Image","fromURL","oImg","copyTuceng","oldObject","clObject","util","object","clone","add","setActiveObject","backgroundColor"],"mappings":"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","file":"main.1f19ae8e.js","sourceRoot":"..","sourcesContent":["// 页面渲染完之后 加载\n$(function(){\n    \n    var canvas = new fabric.Canvas('workSpace',{preserveObjectStacking:true});\n    \n    // canvas.backgroundColor = rgba (255,255,255,1),\n\n    document.onkeydown = function(event) {\n        var e = event || window.event ||\n        arguments.callee.caller.arguments[0];\n        // console.log('e.keycode',e.keyCode);\n        if (e && e.keyCode == 46 || e.keyCode == 8)// delete 键\n            { // 删除图层用\n               var obj = canvas.getActiveObject();\n               if( obj ) {\n               canvas.remove( obj );                    \n            }\n        };\n        if (e && e.keyCode == 188 )// < 键\n             {  //图层向下\n               var obj = canvas.getActiveObject();\n               if( obj ) {\n               canvas.sendBackwards( obj );                    \n            }\n        };\n        if (e && e.keyCode == 190 )// > 键\n             {  //图层向上\n               var obj = canvas.getActiveObject();\n               if( obj ) {\n               canvas.bringForward( obj );                    \n            }\n        };\n\n    };\n\n    textInit = function(){\n        $(canvas.getObjects()).each((index ,item) =>\n        {\n            //console.log( item );\n            //循环得到的type=text的时候\n            if(item.type=='text'){\n\n                item.on( \"selected\", ()=>\n                {\n                    $('#theText').attr('disabled',false);\n                    $('#theText').val(item.text);\n\n                } );\n                \n            }\n        }); \n    }\n\n    update_text = function(){\n        var t = $(\"#theText\").val();\n        if (t.length > 0) {\n            var e = canvas.getActiveObject();\n            //console.log(e),\n            e.set(\"text\", t),\n            canvas.discardActiveObject(),\n            canvas.renderAll(),\n            $(\"#theText\").val(\"\"),\n            $(\"#theText\").attr(\"disabled\", !0)\n        }\n    }\n\n  \n    \n\n    //download按钮\n    downloadImg = function()\n    {\n         //console.log(canvas.toDataURL('png'));\n        download(canvas.toDataURL(), \"factory-output.png\", \"image/png\");\n        \n    }\n    //info按钮 \n    outputInfo = function()\n    {\n        var obj = canvas.getActiveObject();\n            console.log(obj);\n        // if(obj.type == 'image')\n        // {\n            console.log(`top = ${obj.top}`);\n            console.log(`left = ${obj.left}`);\n            console.log(`angle = ${obj.angle}`);\n              console.log(`scaleX = ${obj.scaleX}`);\n            console.log(`scaleY = ${obj.scaleY}`);\n        // }\n    }\n    //加入gif列表    \n    addToGif = function()\n    {\n      var dataUrl = canvas.toDataURL('png');\n      var li = $(\"<li><img src='\" + dataUrl +\"'/></li>\");\n      $(\".gifList\").append( li  );  \n    }\n    //下载Gif\n    downloadGif = function()\n    {\n        var theDelay = $(\"#theDelay\").val();\n       \n        if ($(\".gifList li img\").length < 2)\n            return alert(\"素材数量需≥2\");\n        \n        var gif = new GIF({\n            workerScript: \"gif.worker.js\",\n            workers: 2,\n            quality: 10,\n            width: 460, \n            height: 460\n          });\n        \n          \n          if ( theDelay == 0 )\n          return alert(\"请设置间隔时间\");\n\n        $('.gifList li img').each((index,item)=>\n        {\n            gif.addFrame( item,{ delay: theDelay }); \n        });\n\n        gif.on('finished', function(blob) \n        {\n            download(blob, \"test.gif\", \"image/gif\") ;\n        });\n\n        gif.render();\n\n    }\n    \n\n    \n        //  载入文字\n     var text = new fabric.Text('又出bug了？',  {  left: 110, top: 350 });\n        \n         canvas.insertAt(text,2);\n         text.set('top',350);\n         text.set('left',145);\n         text.set('angle',0);\n         text.set('scaleX',0.68);\n         text.set('scaleY',0.68);\n         \n         // 修改颜色 http://fabricjs.com/docs/fabric.Object.html#fill\n         text.set({cornerSize:15,\n            padding:5,\n            transparentCorners:true,//顶角 是否为空心\n            cornerStyle:'circle',\n            cornerColor:'red',\n            borderColor:'red',\n            borderSize:3  });\n            \n\n    //载入图片\n    fabric.Image.fromURL('moren.jpg', \n    function(oImg) \n        {\n         canvas.insertAt(oImg,0);\n         oImg.set('top',104);\n         oImg.set('left',72);\n         oImg.set('angle',0);\n         oImg.set('scaleX',1);\n         oImg.set('scaleY',1);\n         oImg.set({\n                cornerSize:15,\n                padding:5,\n                transparentCorners:true,//顶角 是否为空心\n                cornerStyle:'circle',\n                cornerColor:'red',\n                borderColor:'red',\n                borderSize:3  });\n         });\n\n\n\n            // 复制图层 \n            copyTuceng = function () {\n                var oldObject = canvas.getActiveObject();\n                if ( oldObject ) {\n                    // console.log(oldObject);\n                    var clObject = fabric.util.object.clone(oldObject);\n                    // console.log(clObject);\n                    //位移一点点，别重合\n                    clObject.set(\"top\", clObject.top + 20);\n                    clObject.set(\"left\", clObject.left + 20);\n                    canvas.add(clObject);\n                    canvas.setActiveObject(clObject);\n                    canvas.renderAll();\n                    // reinit()\n                } else\n                    alert(\"请先选中图层\");\n            }\n\n            // GIF序列双击，删除图层\n            $(\".gifList\").on(\"dblclick\", \"li\", function() {\n                $(this).remove()\n            }),\n           \n            \n        canvas.backgroundColor = \"rgba(255,255,255,1)\";\n        \n           \n\n      // getActiveObject(),insertAt(),sendBackwards(),bringForward\n      // http://fabricjs.com/docs/fabric.Canvas.html\n\n\n      textInit(); \n\n            \n});\n\n\n    "]}